#!/bin/bash
set -e

# Configure AJP connector with secret from environment variable
sed -i "s/<Connector port=\"8009\" protocol=\"AJP\/1.3\" redirectPort=\"8443\" \/>/<Connector port=\"8009\" protocol=\"AJP\/1.3\" redirectPort=\"8443\" secretRequired=\"true\" secret=\"${AJP_SECRET}\" \/>/" /usr/local/tomcat/conf/server.xml
echo "$LUCEE_ADMIN_PASSWORD" > /opt/lucee/server/lucee-server/context/password.txt
chmod 644 /opt/lucee/server/lucee-server/context/password.txt

# Create flag file in root with world-readable permissions
echo "$FLAG" > /flag.txt
chmod 444 /flag.txt


# Execute the CMD
exec "$@" 