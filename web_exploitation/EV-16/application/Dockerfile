FROM xwiki:15.10.7-mysql-tomcat

# Set work directory
WORKDIR /usr/local/tomcat/webapps/ROOT/WEB-INF

# Copy custom xwiki.properties to disable the Distribution Wizard
COPY xwiki.properties ./xwiki.properties

# # Create a script to create the flag file
RUN mkdir -p /usr/local/bin && \
    echo '#!/bin/bash\necho $FLAG > /flag.txt\nchmod 644 /flag.txt' > /usr/local/bin/create-flag.sh && \
    chmod +x /usr/local/bin/create-flag.sh

# Modify the existing entrypoint to run our script
RUN sed -i '2i/usr/local/bin/create-flag.sh' /usr/local/bin/docker-entrypoint.sh