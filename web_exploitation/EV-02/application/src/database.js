const sqlite3 = require('sqlite3').verbose();

function initializeDatabase() {
    const db = new sqlite3.Database(':memory:', (err) => {
        if (err) {
            console.error('Database connection failed:', err);
            return null;
        }
        console.log('Connected to in-memory SQLite database');
    });

    db.serialize(() => {
        db.run(`CREATE TABLE names (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL
        )`);

        db.run(`CREATE TABLE secrets (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            secret_key TEXT,
            secret_value TEXT
        )`);

        const sampleData = [
            'betelguese',
            'mohan',
            'rama',
            'sriram',
            's1r1us',
            'krishna'
        ];

        const insertName = db.prepare('INSERT INTO names (name) VALUES (?)');
        sampleData.forEach(name => {
            insertName.run(name);
        });
        insertName.finalize();

        db.run('INSERT INTO secrets (secret_key, secret_value) VALUES (?, ?)', 
            ['flag', process.env.FLAG]
        );
    });

    return db;
}

module.exports = initializeDatabase; 