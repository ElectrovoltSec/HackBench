#!/bin/bash
set -e

# Create flag file from environment variable
echo "$FLAG" > /flag.txt
chmod 644 /flag.txt
echo "Flag file created at /flag.txt"

# Wait for database to be ready
until nc -z -v -w30 db 3306
do
  echo "Waiting for database connection..."
  sleep 5
done

# Run migrations
php artisan migrate --force

# Run database seeder if needed
# php artisan db:seed --force

# Start Apache
exec "$@" 